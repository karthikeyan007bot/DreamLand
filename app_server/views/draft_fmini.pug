extends layout
block link
    link(rel="stylesheet", href="/stylesheets/fmini.css")
    link(rel="preconnect" href="https://fonts.googleapis.com")
    link(rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
    link(href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100&family=Noto+Color+Emoji&display=swap" rel="stylesheet")
block content
  .posts.text-start.px-3                               
    .header
     span Dream
    .dream-wrap
        .fmini-wrap(id=`${fmini._id}`)
           .fmini-hdr.d-flex 
             .fmini-hdr-img
              if fmini.prflimg 
                img.avator.my-1(src=`https://drive.google.com/uc?export=view&id=${fmini.prflimg}`, alt="", srcset="")        
              else
                div(style='width : 48px; height : 48px; background : purple; border-radius : 50%')
             .fmini-hdr-info.vstack 
                .fmini-hdr-info-up.d-flex
                  .fmini-hdr-usrname #{fmini.userName}  
                  .fmini-hdr-timeStamp.ms-1  #{moment(fmini.timeStamp).startOf('hour').fromNow()}
                  .fmini-feeling-emoji.ps-auto.ms-2  
                     -if(fmini.mood == 'happy')
                      span üòÅ
                     -if(fmini.mood == 'lovely')
                      span ü•∞
                     -if(fmini.mood == 'romantic')
                      span üòç
                     -if(fmini.mood == 'adventurous')
                      span üò±
                     -if(fmini.mood == 'fantastic')
                      span üòé
                     -if(fmini.mood == 'Fabulous')
                       span ü§ó
                     -if(fmini.mood == 'blessed')
                       span üòÅ
                     -if(fmini.mood == 'beautiful')
                       span üòÄ
                     -if(fmini.mood == 'good')
                       span üòÄ                       
                  .fmini-hdr-options.flex-grow-1 
                    a(tabindex='0' data-bs-toggle="popover" data-bs-html='true' data-bs-trigger="focus"  data-bs-content='<div class="list-group list-group-flush"><a href="#" class="list-group-item list-group-item-action " aria-current="true"> The current link item</a><a href="#" class="list-group-item list-group-item-action">A second link item</a><a href="#" class="list-group-item list-group-item-action">A third link item</a><a href="#" class="list-group-item list-group-item-action">A fourth link item</a><a class="list-group-item list-group-item-action ">A disabled link item</a></div> ').options.float-end 
                     .material-symbols-outlined
                       | more_vert  
                .fmini-hdr-usrid-a @#{fmini.userId}
           .fmini-catagory-badge.chip.info #{fmini.catagory}           
           .fmini-body-a.mt-2  #{fmini.body}
       
           .fmini-footer.d-flex.justify-content-between.mt-2
             .fmini-footer-comment 
               button.btn(type='button' tabindex='0' data-bs-toggle="modal"  data-bs-target='#replymdl')
                 i.fa-regular.fa-comment
               a(href=`/${fmini._id}/replies`) 122 
                 span.lapdisp(style='font-size:15px') replies
             .fmini-footer-reactions 
               button.btn#emoji-rxn-btn(type='button' tabindex='0' data-bs-toggle="modal"  data-bs-target='#react-modal' onclick=`getRxns('${fmini._id}', '${fmini._id}')`).fmini-footer-react 
                 i.fa-regular.fa-face-smile       
                 span  #{fmini.reactions.length} 
                  span.lapdisp(style='font-size:15px')  reactions
             .fmini-footer-alter 
               button.btn(type='button' tabindex='0' data-bs-toggle="modal"  data-bs-target='#altrmdl')
                 i.fa-solid.fa-pencil
               a(href=`/${fmini._id}/alters`) 45 
                 span.lapdisp(style='font-size:15px') alters
             .fmini-footer-annex 
               button.btn(type='button' tabindex='0' data-bs-toggle="modal"  data-bs-target='#annexmdl')
                 i.fa-solid.fa-plus 
               a(href=`/${fmini._id}/annexures`) 93 
                span.lapdisp(style='font-size:15px') annex       
             button.btn.fmini-footer-share(type='button' tabindex='0' data-bs-toggle="modal"  data-bs-target='#sharemdl')
              i.fa-solid.fa-share-nodes  
             #altrmdl.modal.fade(data-bs-backdrop="static" tabindex='-1' aria-labelledby='fantamodalLabel1' aria-hidden='true')
                 .modal-dialog.modal-fullscreen-sm-down
                   .modal-content
                     .modal-header
                          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close') 
                     .modal-body 
                       .fanta-options.float-end 
                         label(for="alter-fileinp").mx-1 
                            span(class="material-symbols-outlined")
                              | add_photo_alternate
                            input#alter-fileinp(name="fantaimage", type="file", onchange="readURL(this,'alter-fileinp')").d-none    
                         a.mx-1(href=''  data-bs-toggle='collapse' data-bs-target='#alter-gif' aria-expanded='false')
                             span(class="material-symbols-outlined")
                                    |gif_box                                                                                                                                                                          
                             button.btn.ibtn#-alter-load-gif(type='button' style='display:none') Load more                                                          
                       img(src="", alt="", srcset="")#alterimg
                       textarea#alter.form-control(name="", cols="30") #{fmini.body}
                       #alter-gif.collapse
                           .card.card-body
                             input#altergfsrch.form-control(type="search", name="altergfsrch", placeholder='Search Tenor', onkeyup='suggest(this)')
                             #tenor-suggestion
                               .no-scrollbar(style='max-width : 100%;overflow-x: scroll;padding:20px')
                                 div(style='width:2000px')
                                  .radios
                                    label(for='a1')
                                      input#a1(type='radio' name='alter-tenor-suggestion'  checked='')
                                      span.alter-tnr-sugsns                                        
                                    label(for='b2')
                                      input#b2(type='radio' name='alter-tenor-suggestion' )
                                      span.alter-tnr-sugsns                                       
                                    label(for='c3')
                                      input#c3(type='radio' name='alter-tenor-suggestion' )
                                      span.alter-tnr-sugsns                       
                             #alter-gif-preview-container.no-scrollbar()
                       button.btn.ibtn(type = 'button' onclick=`postFminiTarget('${fmini._id}', 'alter')`) Add Alter                 
             #replymdl.modal.fade(data-bs-backdrop="static" tabindex='-1' aria-labelledby='fantamodalLabel1' aria-hidden='true')
                 .modal-dialog.modal-fullscreen-sm-down
                   .modal-content
                     .modal-header
                          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close') 
                     .modal-body
                       .fanta-options.float-end 
                         label(for="reply-fileinp").mx-1 
                            span(class="material-symbols-outlined")
                              | add_photo_alternate
                            input#reply-fileinp(name="fantaimage", type="file", onchange="readURL(this,'reply-fileinp')").d-none    
                         a.mx-1(href=''  data-bs-toggle='collapse' data-bs-target='#reply-gif' aria-expanded='false')
                             span(class="material-symbols-outlined")
                                    |gif_box                                                                                                                                                                          
                             button.btn.ibtn#-reply-load-gif(type='button' style='display:none') Load more                                                          
                       img(src="", alt="", srcset="")#replyimg
                       textarea#reply.form-control(name="", cols="30") 
                       #reply-gif.collapse
                           .card.card-body
                             input#replygfsrch.form-control(type="search", name="replygfsrch", placeholder='Search Tenor', onkeyup='suggest(this)')
                             #tenor-suggestion
                               .no-scrollbar(style='max-width : 100%;overflow-x: scroll;padding:20px')
                                 div(style='width:2000px')
                                  .radios
                                    label(for='a1')
                                      input#a1(type='radio' name='reply-tenor-suggestion'  checked='')
                                      span.reply-tnr-sugsns                                        
                                    label(for='b2')
                                      input#b2(type='radio' name='reply-tenor-suggestion' )
                                      span.reply-tnr-sugsns                                       
                                    label(for='c3')
                                      input#c3(type='radio' name='reply-tenor-suggestion' )
                                      span.reply-tnr-sugsns                       
                             #reply-gif-preview-container.no-scrollbar()
                       button.btn.ibtn(type = 'button' onclick=`postFminiTarget('${fmini._id}', 'reply')`) Reply 
             #annexmdl.modal.fade(data-bs-backdrop="static" tabindex='-1' aria-labelledby='fantamodalLabel1' aria-hidden='true')
                 .modal-dialog.modal-fullscreen-sm-down
                   .modal-content
                     .modal-header
                          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close') 
                     .modal-body 
                       .fanta-options.float-end 
                         label(for="annex-fileinp").mx-1 
                            span(class="material-symbols-outlined")
                              | add_photo_alternate
                            input#annex-fileinp(name="fantaimage", type="file", onchange="readURL(this,'annex-fileinp')").d-none    
                         a.mx-1(href=''  data-bs-toggle='collapse' data-bs-target='#annex-gif' aria-expanded='false')
                             span(class="material-symbols-outlined")
                                    |gif_box                                                                                                                                                                          
                             button.btn.ibtn#-annex-load-gif(type='button' style='display:none') Load more                                                          
                       img(src="", alt="", srcset="")#anneximg
                       textarea#annex.form-control(name="", cols="30") 
                       #annex-gif.collapse
                           .card.card-body
                             input#annexgfsrch.form-control(type="search", name="annexgfsrch", placeholder='Search Tenor', onkeyup='suggest(this)')
                             #tenor-suggestion
                               .no-scrollbar(style='max-width : 100%;overflow-x: scroll;padding:20px')
                                 div(style='width:2000px')
                                  .radios
                                    label(for='a1')
                                      input#a1(type='radio' name='annex-tenor-suggestion'  checked='')
                                      span.annex-tnr-sugsns                                        
                                    label(for='b2')
                                      input#b2(type='radio' name='annex-tenor-suggestion' )
                                      span.annex-tnr-sugsns                                       
                                    label(for='c3')
                                      input#c3(type='radio' name='annex-tenor-suggestion' )
                                      span.annex-tnr-sugsns                       
                             #annex-gif-preview-container.no-scrollbar() 
                       button.btn.ibtn(type = 'button' onclick=`postFminiTarget('${fmini._id}', 'annex')`) Add Annex
                                                        
                  
             #react-modal.modal.fade(data-bs-backdrop="static" tabindex='-1' aria-labelledby='fantamodalLabel1' aria-hidden='true')
                 .modal-dialog
                   .modal-content
                     .modal-header
                          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close') 
                     .modal-body
                       .scrollbox.overflow-scroll
                         .grd(style='width : 1000px')
                           .hstack 
                             a.emoji-rxns.mx-3#lol( onclick=`postRxn(this,"${fmini._id}")`) üòÇ
                             a.emoji-rxns.mx-3#love( onclick=`postRxn(this,"${fmini._id}")`) ü•∞
                             a.emoji-rxns.mx-3#hug( onclick=`postRxn(this,"${fmini._id}")`) ü§ó
                             a.emoji-rxns.mx-3#no-rxn( onclick=`postRxn(this,"${fmini._id}")`) üòê
                             a.emoji-rxns.mx-3#bored( onclick=`postRxn(this,"${fmini._id}")`) ü•±
                             a.emoji-rxns.mx-3#anger( onclick=`postRxn(this,"${fmini._id}")`) üò°
                             a.emoji-rxns.mx-3#broken-heart( onclick=`postRxn(this,"${fmini._id}")`) üíî
                             a.emoji-rxns.mx-3#cry( onclick=`postRxn(this,"${fmini._id}")`) üò≠
                             a.emoji-rxns.mx-3#mind-blowing( onclick=`postRxn(this,"${fmini._id}")`) ü§Ø
                       h6 Reactions
                       ul.list-group.list-group-flush.reaction-infos(id=`reactions-${fmini._id}`) 
                        for reaction in fmini.reactions
                         li.list-group-item
                          a(href='').fmini-rxn-hdr.d-flex 
                            .fmini-rxn-hdr-img
                              if fmini.prflimg
                                img.avator(src=`https://drive.google.com/uc?export=view&id=${fmini.prflimg}` alt='')
                              else 
                               div(style='width : 48px; height : 48px; background : purple')
                            .fmini-rxn-hdr-info.vstack 
                               .fmini-rxn-hdr-info-up.d-flex
                                 .fmini-rxn-hdr-usrname=reaction.usrName 
                               .fmini-rxn-hdr-usrid @#{reaction.usrId}    
                            .fmini-feeling-emoji.float-end  
                              -if(reaction.reaction == 'no-rxn')
                                  span üòê
                              -if(reaction.reaction == 'love')
                                  span ü•∞
                              -if(reaction.reaction == 'lol')
                                  span üòÇ
                              -if(reaction.reaction == 'hug')
                                  span ü§ó
                              -if(reaction.reaction == 'bored')
                                  span ü•±
                              -if(reaction.reaction == 'anger')
                                   span üò°
                              -if(reaction.reaction == 'broken-heart')
                                   span üíî
                              -if(reaction.reaction == 'mind-blowing')
                                   span ü§Ø
                              -if(reaction.reaction == 'cry')
                                   span üò≠                                                                         
             #sharemdl.modal.fade(data-bs-backdrop="static" tabindex='-1' aria-labelledby='fantamodalLabel1' aria-hidden='true')
                 .modal-dialog
                   .modal-content
                     .modal-header
                          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close') 
                     .modal-body 
                      .share-btn(data-url='https://...' data-title='...' data-desc='...')
                        a.btn(type = ' button' data-id='vk')
                          i.fab.fa-vk
                          |  VK
                        a.btn(type = ' button' data-id='fb')
                          i.fab.fa-facebook-square
                          |  Facebook
                        a.btn(type = ' button' data-id='tw')
                          i.fab.fa-twitter
                          |  Twitter
                        a.btn(type = ' button' data-id='tg')
                          i.fab.fa-telegram
                          |  Telegram
                        a.btn(type = ' button' data-id='mail')
                          i.fas.fa-at
                          |  EMail
                           
             button.btn.reply-footer-share(type='button' tabindex='0' data-bs-toggle="modal"  data-bs-target='#sharemdl')
              i.fa-solid.fa-share-nodes           

                       
block script      
     script(src="//cdn.jsdelivr.net/npm/share-buttons/dist/share-buttons.js")
     script(src="/javascripts/fmini.js" defer)  
     script.
        function postReply(fminiId,target, parentId ){
          var body, media;
          var usrRefId =  parseJwt(getCookie('indigotoken'))._id;
        }
        async function getRxns(fminiId, parentId){
          await fetch(`/api/${fminiId}/${parentId}/rxns`).then(data => data.json()).then( res => console.log(res))
        }
